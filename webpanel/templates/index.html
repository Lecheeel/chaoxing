<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超星学习通 - 签到管理系统</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- DataTables with Bootstrap 5 -->
    <link href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css" rel="stylesheet">
    <!-- Toastify -->
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-graduation-cap me-2"></i>超星学习通管理面板
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#users">
                            <i class="fas fa-users me-1"></i>用户管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#sign">
                            <i class="fas fa-check-circle me-1"></i>签到管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#location">
                            <i class="fas fa-map-marker-alt me-1"></i>位置管理
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <!-- 页面标题 -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold text-primary">
                    <i class="fas fa-graduation-cap me-3"></i>超星学习通签到管理系统
                </h1>
                <p class="lead text-muted">便捷管理您的超星账号和自动签到任务</p>
            </div>
        </div>
        
        <!-- 用户管理 -->
        <div id="users" class="section">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h2><i class="fas fa-users text-primary me-2"></i>用户管理</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                        <i class="fas fa-user-plus me-2"></i>添加用户
                    </button>
                </div>
                <div class="card-body">
                    <div class="alert alert-info d-flex align-items-center">
                        <i class="fas fa-info-circle me-3 fs-4"></i>
                        <div>提示：用户列表展示当前已登录的所有账户，可以进行管理和签到操作。</div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="userTable">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>手机号</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 用户列表将通过JS动态加载 -->
                            </tbody>
                        </table>
                    </div>

                    <!-- 用户表格操作按钮样式模板 (用于JS) -->
                    <template id="userActionsTemplate">
                        <div class="btn-group">
                            <button class="btn btn-sm btn-info text-white edit-user" title="编辑用户">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-warning text-white toggle-active" title="切换状态">
                                <i class="fas fa-power-off"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-user" title="删除用户">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button class="btn btn-sm btn-success sign-user" title="立即签到">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </template>
                    
                    <!-- 用户状态徽章样式模板 (用于JS) -->
                    <template id="userStatusTemplate">
                        <span class="status-badge"></span>
                    </template>
                </div>
            </div>
        </div>

        <!-- 签到管理 -->
        <div id="sign" class="section mt-5">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h2><i class="fas fa-check-circle text-success me-2"></i>签到管理</h2>
                    <button class="btn btn-success" id="batchSignBtn">
                        <i class="fas fa-tasks me-2"></i>批量签到
                    </button>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning d-flex align-items-center">
                        <i class="fas fa-exclamation-triangle me-3 fs-4"></i>
                        <div>注意：批量签到会为所有激活的用户进行签到操作，请确保已设置好位置信息。</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="excludeInactiveUsers" checked>
                                <label class="form-check-label" for="excludeInactiveUsers">
                                    排除未激活的用户
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3 p-3 border rounded bg-light">
                                <label class="form-label fw-bold">位置设置</label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="useRandomOffset" checked>
                                    <label class="form-check-label" for="useRandomOffset">
                                        启用位置随机偏移（防止检测）
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="batchSignResult" class="mt-4">
                        <!-- 批量签到结果将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 位置管理 -->
        <div id="location" class="section mt-5">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2><i class="fas fa-map-marker-alt text-danger me-2"></i>位置管理</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-info d-flex align-items-center">
                        <i class="fas fa-info-circle me-3 fs-4"></i>
                        <div>提示：在这里管理用户的位置信息，用于位置签到。</div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="userSelect" class="form-label fw-bold">选择用户</label>
                        <div class="d-flex gap-2">
                            <select class="form-select" id="userSelect">
                                <option value="">-- 请选择用户 --</option>
                                <!-- 用户选项将通过JS动态加载 -->
                            </select>
                            <button class="btn btn-primary" id="batchSetLocationBtn">
                                <i class="fas fa-map-marked-alt me-2"></i>批量设置位置
                            </button>
                        </div>
                    </div>

                    <div id="locationPresets" class="mt-5">
                        <h3 class="mb-3"><i class="fas fa-bookmark text-info me-2"></i>位置预设</h3>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="presetTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>地址</th>
                                        <th>经度</th>
                                        <th>纬度</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 位置预设列表将通过JS动态加载 -->
                                </tbody>
                            </table>
                        </div>

                        <button class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#addLocationModal">
                            <i class="fas fa-plus me-2"></i>添加位置预设
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加用户模态框 -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>添加新用户</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="phone" class="form-label">手机号</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-mobile-alt"></i></span>
                                <input type="text" class="form-control" id="phone" required placeholder="请输入手机号">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">密码</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="password" required placeholder="请输入密码">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-primary" id="addUserBtn">
                        <i class="fas fa-plus me-2"></i>添加
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑用户模态框 -->
    <div class="modal fade" id="editUserModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="fas fa-user-edit me-2"></i>编辑用户</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="originalPhone">
                        <div class="mb-3">
                            <label for="editUsername" class="form-label">用户名</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="editUsername" placeholder="用户名" readonly>
                                <div class="input-group-text bg-light text-muted">
                                    <i class="fas fa-lock-alt"></i> 不可编辑
                                </div>
                            </div>
                            <small class="text-muted">用户名由系统自动获取，不可手动修改</small>
                        </div>
                        <div class="mb-3">
                            <label for="editPhone" class="form-label">手机号</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-mobile-alt"></i></span>
                                <input type="text" class="form-control" id="editPhone" placeholder="请输入手机号">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">当前密码</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="text" class="form-control" id="currentPassword" readonly>
                                <button class="btn btn-outline-secondary" type="button" id="toggleCurrentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editPassword" class="form-label">新密码（留空则不修改）</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="editPassword" placeholder="输入新密码">
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3 form-check form-switch">
                            <input type="checkbox" class="form-check-input" id="editActive">
                            <label class="form-check-label" for="editActive">激活状态</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-info text-white" id="saveUserBtn">
                        <i class="fas fa-save me-2"></i>保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加位置预设模态框 -->
    <div class="modal fade" id="addLocationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-map-pin me-2"></i>添加位置预设</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addLocationForm">
                        <div class="mb-3">
                            <label for="locationAddress" class="form-label">地址</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-map"></i></span>
                                <input type="text" class="form-control" id="locationAddress" required placeholder="输入地址名称">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="locationLon" class="form-label">经度</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-arrows-alt-h"></i></span>
                                <input type="text" class="form-control" id="locationLon" required placeholder="如：116.3972282409668">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="locationLat" class="form-label">纬度</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-arrows-alt-v"></i></span>
                                <input type="text" class="form-control" id="locationLat" required placeholder="如：39.90960456049752">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-success" id="addLocationBtn">
                        <i class="fas fa-plus me-2"></i>添加
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 批量设置位置模态框 -->
    <div class="modal fade" id="batchSetLocationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-map-marked-alt me-2"></i>批量设置位置</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="batchSetLocationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="batchLocationAddress" class="form-label">地址</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-map"></i></span>
                                        <input type="text" class="form-control" id="batchLocationAddress" required placeholder="输入地址名称">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="batchLocationLon" class="form-label">经度</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-arrows-alt-h"></i></span>
                                        <input type="text" class="form-control" id="batchLocationLon" required placeholder="如：116.3972282409668">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="batchLocationLat" class="form-label">纬度</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-arrows-alt-v"></i></span>
                                <input type="text" class="form-control" id="batchLocationLat" required placeholder="如：39.90960456049752">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">选择用户</label>
                            <div class="border p-3 rounded bg-light" style="max-height: 200px; overflow-y: auto;">
                                <!-- 用户复选框将通过JS动态加载 -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-primary" id="saveBatchLocationBtn">
                        <i class="fas fa-save me-2"></i>保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 依赖 -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Axios HTTP 客户端 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Toastify -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <!-- 自定义脚本 -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html> 